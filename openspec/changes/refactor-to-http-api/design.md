# 设计：HTTP API 悬浮窗

## 架构概览

```
┌─────────────────────────────────────────────────────────────┐
│                    Vibe Process Bar                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 悬浮窗 UI    │◄─┤ 状态管理    │◄─┤ HTTP API 服务器     │  │
│  │ (React)     │  │ (Zustand)   │  │ (Rust/Tauri)        │  │
│  └─────────────┘  └─────────────┘  └──────────────┬────────┘  │
│        │                                        │            │
│        │ 激活窗口                                 │ POST      │
│        ▼                                        ▼            │
│  ┌─────────────┐                         ┌─────────────┐    │
│  │ 窗口管理器   │                         │ IDE (外部)   │    │
│  │ (Rust)      │                         │ Claude Code │    │
│  └─────────────┘                         │ Cursor      │    │
│                                           └─────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

## HTTP API 设计

### 服务器配置

- **端口**：31415（默认）
- **地址**：127.0.0.1（仅本地）
- **协议**：HTTP

### API 端点

| 方法 | 路径 | 功能 |
|------|------|------|
| POST | /api/task/start | 开始新任务 |
| POST | /api/task/progress | 更新进度 |
| POST | /api/task/token | 更新 token 数 |
| POST | /api/task/complete | 完成任务 |
| POST | /api/task/error | 任务错误 |
| POST | /api/task/cancel | 取消任务 |
| GET | /api/status | 获取当前状态 |
| POST | /api/window/activate | 激活窗口 |

### 窗口管理

- 悬浮窗点击时，根据任务信息激活对应的 IDE 窗口
- 支持通过窗口标题、进程名或自定义标识来定位窗口

## 悬浮窗显示

### 显示内容

- **Token 数**：当前任务的 token 消耗
- **进度条**：任务完成百分比
- **状态**：进行中、已完成、错误
- **任务名称**：简短描述

### 交互

- **左键点击**：激活对应 IDE 窗口
- **右键菜单**：设置、重置、位置调整
- **滚轮**：调节进度

## 移除 VSCode 集成

需要删除的组件：
1. `vscode-extension/` 目录
2. `src/utils/adapters/` 中的 VSCode 相关适配器
3. `src/stores/progressStore.ts` 中的 VSCode 设置
4. 相关测试文件
5. 相关文档

## 依赖变更

### 新增依赖

- `tonic` 或 `warp`（Rust HTTP 服务器）

### 移除依赖

- `ws`（WebSocket，不再需要）
- VSCode 扩展相关依赖
